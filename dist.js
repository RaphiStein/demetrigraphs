function setup(){demetriGraphs.globals.origin.x=demetriGraphs.globals.margin,demetriGraphs.globals.origin.y=demetriGraphs.constants.canvassize.HEIGHT-demetriGraphs.globals.margin,demetriGraphs.globals.p5Canvas=createCanvas(demetriGraphs.constants.canvassize.WIDTH,demetriGraphs.constants.canvassize.HEIGHT).parent("graphArea"),background(0),textSize(22),demetriGraphs.content.updateAxisLabel("x",demetriGraphs.content.getAxisLabels().x.text),demetriGraphs.content.updateAxisLabel("y",demetriGraphs.content.getAxisLabels().y.text),demetriGraphs.content.startFresh()}function draw(){background(255),stroke(0,0,0),strokeWeight(1),push(),translate(40,demetriGraphs.constants.canvassize.HEIGHT/2+demetriGraphs.content.getAxisLabels().y.width/2),angleMode(DEGREES),rotate(270),fill(0);text(demetriGraphs.content.getAxisLabels().y.text,0,0);pop(),push(),translate(demetriGraphs.constants.canvassize.WIDTH/2-demetriGraphs.content.getAxisLabels().x.width/2,demetriGraphs.constants.canvassize.HEIGHT-30),fill(0);text(demetriGraphs.content.getAxisLabels().x.text,0,0);pop(),line(demetriGraphs.globals.origin.x,0,demetriGraphs.globals.origin.x,demetriGraphs.constants.canvassize.HEIGHT),line(0,demetriGraphs.globals.origin.y,demetriGraphs.constants.canvassize.WIDTH,demetriGraphs.globals.origin.y),noFill();var a=demetriGraphs.content.getSegments();if(demetriGraphs.globals.smooth){beginShape(),curveVertex(a[0].points.controlPoint1.x,a[0].points.controlPoint1.y),curveVertex(a[0].points.anchorPoint1.x,a[0].points.anchorPoint1.y),demetriGraphs.globals.smoothShowAnchors&&ellipse(a[0].points.anchorPoint1.x,a[0].points.anchorPoint1.y,8,8);for(var b=0;b<a.length;b++)curveVertex(a[b].points.anchorPoint2.x,a[b].points.anchorPoint2.y),demetriGraphs.globals.smoothShowAnchors&&ellipse(a[b].points.anchorPoint2.x,a[b].points.anchorPoint2.y,8,8);curveVertex(a[a.length-1].points.controlPoint2.x,a[demetriGraphs.content.getSegments().length-1].points.controlPoint2.y),endShape()}else for(var b in a){var c=a[b];stroke(c.color.r,c.color.g,c.color.b),strokeWeight(c.weight),curve(c.points.controlPoint1.x,c.points.controlPoint1.y,c.points.anchorPoint1.x,c.points.anchorPoint1.y,c.points.anchorPoint2.x,c.points.anchorPoint2.y,c.points.controlPoint2.x,c.points.controlPoint2.y),b==demetriGraphs.globals.selectedSegment&&(ellipse(c.points.controlPoint1.x,c.points.controlPoint1.y,10,10),ellipse(c.points.controlPoint2.x,c.points.controlPoint2.y,10,10))}}function mousePressed(){if(console.log("mousePressed"),demetriGraphs.utils.onCanvas(mouseX,mouseY)){ellipse(mouseX,mouseY,10,10);var a=new demetriGraphs.Point(mouseX,mouseY);return demetriGraphs.globals.selectionLocked?(demetriGraphs.globals.selectedPoint=demetriGraphs.utils.findClosestPointInSegment(demetriGraphs.globals.selectedSegment,a),void demetriGraphs.dom.updateSegmentSelect(demetriGraphs.content.getSegments().length,demetriGraphs.globals.selectedSegment)):(demetriGraphs.globals.selectedPoint=demetriGraphs.utils.findClosestPointInAllSegments(a),void demetriGraphs.dom.updateSegmentSelect(demetriGraphs.content.getSegments().length,demetriGraphs.globals.selectedSegment))}}function mouseDragged(){return demetriGraphs.utils.onCanvas(mouseX,mouseY)&&Object.keys(demetriGraphs.globals.selectedPoint).length&&(demetriGraphs.globals.selectedPoint.x=mouseX,demetriGraphs.globals.selectedPoint.y=mouseY,demetriGraphs.dom.updateControlpointInputs(demetriGraphs.content.getSegments()[demetriGraphs.globals.selectedSegment].points)),!1}var demetriGraphs={};demetriGraphs.constants=function(){return{canvassize:{WIDTH:800,HEIGHT:600},colors:{black:{r:0,g:0,b:0}}}}(),demetriGraphs.globals=function(){return{defaultWeight:2,selectedWeight:5,selectedPoint:{},selectedSegment:-1,selectionLocked:!1,origin:{},p5Canvas:{},margin:60,smooth:!1,smoothShowAnchors:!1}}(),demetriGraphs.Point=function(a,b){this.x=a,this.y=b,this.getDistanceTo=function(a){var b=Math.abs(a.x-this.x),c=Math.abs(a.y-this.y),d=Math.sqrt(Math.pow(b,2)+Math.pow(c,2));return d}},demetriGraphs.CurveSegment=function(a,b,c,d,e){this.points={controlPoint1:a,anchorPoint1:b,anchorPoint2:c,controlPoint2:d},this.color={r:Math.floor(170*Math.random()+85),g:Math.floor(170*Math.random()+85),b:Math.floor(170*Math.random()+85)},this.weight=e,this.resetControlPoints=function(){this.points.controlPoint1=new Point(demetriGraphs.constants.canvassize.WIDTH/2+5,demetriGraphs.constants.canvassize.HEIGHT/2),this.points.controlPoint2=new Point(demetriGraphs.constants.canvassize.WIDTH/2-5,demetriGraphs.constants.canvassize.HEIGHT/2)},this.toggleWeight=function(){this.weight==demetriGraphs.globals.defaultWeight?this.weight=demetriGraphs.globals.selectedWeight:this.weight=demetriGraphs.globals.defaultWeight}},demetriGraphs.content=function(){var a=[],b={x:{text:"Enter a label for the x axis",width:0},y:{text:"Enter a label for the y axis",width:0}},c=50,d=function(){return c*=-1};return{getSegments:function(){return a},getAxisLabels:function(){return b},startFresh:function(){this.initializeSegments();demetriGraphs.dom.updateSegmentSelect(demetriGraphs.content.getSegments().length),demetriGraphs.globals.smooth=!1},undo:function(){alert("Undo not implemented yet")},updateAxisLabel:function(a,c){var d=demetriGraphs.globals.p5Canvas.canvas,e=d.getContext("2d"),f=e.measureText(c).width;console.log("widthOfText: ",f),b[a].text=c,b[a].width=f},resetControlPoints:function(){demetriGraphs.content.getSegments()[demetriGraphs.globals.selectedSegment].resetControlPoints()},addSegment:function(){var b=demetriGraphs.content.getSegments()[demetriGraphs.content.getSegments().length-1],c=b.points.anchorPoint2,e=new demetriGraphs.Point(c.x,c.y),f=c,g=d(),h=new demetriGraphs.Point(a[a.length-1].points.anchorPoint2.x+50,a[a.length-1].points.anchorPoint2.y+g),i=new demetriGraphs.Point(a[a.length-1].points.anchorPoint2.x+50,a[a.length-1].points.anchorPoint2.y+g),j=new demetriGraphs.CurveSegment(e,f,h,i,demetriGraphs.globals.defaultWeight);demetriGraphs.content.getSegments().push(j),console.log("demetriGraphs.content.getSegments()",demetriGraphs.content.getSegments()),demetriGraphs.dom.updateSegmentSelect(demetriGraphs.content.getSegments().length)},deleteLastSegment:function(){demetriGraphs.globals.selectedSegment===demetriGraphs.content.getSegments().length-1&&(demetriGraphs.globals.selectedSegment=-1),demetriGraphs.content.getSegments().length>1&&demetriGraphs.content.getSegments().splice(-1),demetriGraphs.dom.updateSegmentSelect(demetriGraphs.content.getSegments().length)},lockSelection:function(){demetriGraphs.globals.selectionLocked=!demetriGraphs.globals.selectionLocked,demetriGraphs.dom.toggleSelectedSegmentDropdownLock()},selectSegment:function(a){demetriGraphs.globals.selectionLocked||(a<0?(demetriGraphs.content.getSegments()[demetriGraphs.globals.selectedSegment].toggleWeight(),demetriGraphs.globals.selectedSegment=-1):(demetriGraphs.globals.selectedSegment<demetriGraphs.content.getSegments().length&&demetriGraphs.globals.selectedSegment!==-1&&demetriGraphs.content.getSegments()[demetriGraphs.globals.selectedSegment].toggleWeight(),demetriGraphs.content.getSegments()[a].toggleWeight(),demetriGraphs.globals.selectedSegment=a,demetriGraphs.dom.updateControlpointInputs(demetriGraphs.content.getSegments()[a].points)))},controlPointInputUpdated:function(a,b){switch(a){case"controlpoint0_x":demetriGraphs.content.getSegments()[demetriGraphs.globals.selectedSegment].points.controlPoint1.x=b;break;case"controlpoint0_y":demetriGraphs.content.getSegments()[demetriGraphs.globals.selectedSegment].points.controlPoint1.y=b;break;case"controlpoint1_x":demetriGraphs.content.getSegments()[demetriGraphs.globals.selectedSegment].points.controlPoint2.x=b;break;case"controlpoint1_y":demetriGraphs.content.getSegments()[demetriGraphs.globals.selectedSegment].points.controlPoint2.y=b}},smoothen:function(){demetriGraphs.globals.smooth=!demetriGraphs.globals.smooth},showAnchorPoints:function(){return demetriGraphs.globals.smooth?void(demetriGraphs.globals.smoothShowAnchors=!demetriGraphs.globals.smoothShowAnchors):void alert("Only available when smooth mode is on")},initializeSegments:function(){a=[];var b=new demetriGraphs.Point(demetriGraphs.constants.canvassize.WIDTH/2+10,demetriGraphs.constants.canvassize.HEIGHT/2),c=new demetriGraphs.Point(demetriGraphs.globals.origin.x,demetriGraphs.globals.origin.y),d=new demetriGraphs.Point(demetriGraphs.constants.canvassize.WIDTH/2,demetriGraphs.constants.canvassize.HEIGHT/2),e=new demetriGraphs.Point(demetriGraphs.constants.canvassize.WIDTH/2-10,demetriGraphs.constants.canvassize.HEIGHT/2);a.push(new demetriGraphs.CurveSegment(b,c,d,e,demetriGraphs.globals.defaultWeight))},saveGraph:function(){var a=document.getElementById("demetriGraphsLogo");demetriGraphs.globals.p5Canvas.canvas.getContext("2d").drawImage(a,demetriGraphs.constants.canvassize.WIDTH-150,demetriGraphs.constants.canvassize.HEIGHT-50);var b={};$.extend(!0,b,demetriGraphs.globals.p5Canvas),saveCanvas("canvasWithWatermark","jpg")}}}(),demetriGraphs.utils=function(){return{onCanvas:function(a,b){var c=!(a<0||a>demetriGraphs.constants.canvassize.WIDTH||b<0||b>demetriGraphs.constants.canvassize.HEIGHT);return c},findClosestPointInSegment:function(a,b){var c=Number.POSITIVE_INFINITY,d={};for(var e in demetriGraphs.content.getSegments()[a].points){var f=demetriGraphs.content.getSegments()[a].points[e].getDistanceTo(b);f<c&&f<30&&(c=f,d=demetriGraphs.content.getSegments()[a].points[e],demetriGraphs.content.selectSegment(a))}return d},findClosestPointInAllSegments:function(a){var b,c=Number.POSITIVE_INFINITY,d={},e=demetriGraphs.content.getSegments();for(var f in e)for(var g in e[f].points)b=e[f].points[g].getDistanceTo(a),b<c&&b<30&&(c=b,d=e[f].points[g],demetriGraphs.content.selectSegment(f));return d}}}(),function(){demetriGraphs.globals.origin.x=demetriGraphs.globals.margin,demetriGraphs.globals.origin.y=demetriGraphs.constants.canvassize.HEIGHT-demetriGraphs.globals.margin}(),demetriGraphs.dom=function(){return{updateSegmentSelect:function(a,b){console.log("updateSegmentSelect"),$("#selectedSegmentDropdown").empty(),b?$("#selectedSegmentDropdown").append('<option value="-1" selected="selected">Select Segment</option>'):$("#selectedSegmentDropdown").append('<option value="-1">Select Segment</option>');for(var c=0;c<a;)console.log("i",c),$("#selectedSegmentDropdown").append('<option value="'+c+'">'+c+"</option>"),c++;$("#selectedSegmentDropdown").val(b?b:demetriGraphs.globals.selectedSegment)},updateControlpointInputs:function(a){$("#controlpoint0_x").val(a.controlPoint1.x),$("#controlpoint0_y").val(a.controlPoint1.y),$("#controlpoint1_x").val(a.controlPoint2.x),$("#controlpoint1_y").val(a.controlPoint2.y)},toggleSelectedSegmentDropdownLock:function(){var a=$("#selectedSegmentDropdown").prop("disabled");a?$("#selectedSegmentDropdown").prop("disabled",!1):$("#selectedSegmentDropdown").prop("disabled",!0)}}}();